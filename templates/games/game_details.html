<!-- templates/games/generation_success.html -->
{% extends "base.html" %}
{% block title %}R√©sultat de la g√©n√©ration{% endblock %}
{% block content %}
{% csrf_token %}
<div class="game-actions">
    <button class="favorite-btn {% if request.user in game.favorites.all %}active{% endif %}" 
            data-game-id="{{ game.id }}" 
            onclick="toggleFavorite(this)">
        <i class="fas {% if request.user in game.favorites.all %}fa-star{% else %}fa-regular fa-star{% endif %}"></i>
        <span>Favoris</span>
    </button>
</div>

<script>
    function toggleFavorite(button) {
        const gameId = button.dataset.gameId;
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        fetch(`/game/${gameId}/favorite/`, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                const icon = button.querySelector('i');
                if (data.is_favorite) {
                    button.classList.add('active');
                    icon.classList.remove('fa-regular');
                    icon.classList.remove('fa-star');
                    icon.classList.add('fas');
                    icon.classList.add('fa-star');
                } else {
                    button.classList.remove('active');
                    icon.classList.remove('fas');
                    icon.classList.remove('fa-star');
                    icon.classList.add('fa-regular');
                    icon.classList.add('fa-star');
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Une erreur est survenue lors de la mise √† jour des favoris');
        });
    }
</script>

<h3>üéÆ Jeu g√©n√©r√© avec succ√®s</h3>

<h2>{{ game.title }}</h2>


{% if game.image_environment %}
    <div class="game-illustration">
        <h3>üñºÔ∏è Illustration g√©n√©r√©e</h3>
        <img src="{{ game.image_environment.url }}" alt="Image g√©n√©r√©e">
    </div>
{% endif %}

<div class="game-details">
    <p><strong>Genre :</strong> {{ game.genre }}</p>
    <p><strong>Ambiance :</strong> {{ game.ambiance }}</p>
    <p><strong>Mots-cl√©s :</strong> {{ game.keywords }}</p>
    <p><strong>R√©f√©rences :</strong> {{ game.references }}</p>
</div>

<div class="game-content">
    {{ game.universe|safe|linebreaks }}
</div>

<div class="game-scenario">
    <h3>üìñ Sc√©nario</h3>
    {{ game.story|safe|linebreaks }}
</div>


<a href="{% url 'dashboard' %}" class="button">Retour au tableau de bord</a>
{% endblock %}

<style>
    .favorite-btn {
    background: transparent;
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.favorite-btn:hover {
    background: var(--primary-color);
    color: var(--bg-dark);
}

.favorite-btn.active {
    background: var(--primary-color);
    color: var(--bg-dark);
}

.favorite-btn i {
    font-size: 1.2em;
}

.game-card {
    background: var(--bg-medium);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    transition: transform 0.3s ease;
}

.game-card:hover {
    transform: translateY(-5px);
}

.game-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 8px;
    margin: 10px 0;
}
</style>